---
import { getCollection } from 'astro:content';

const features = await getCollection('features');

const sortedFeatures = await Promise.all(
  features
    .sort((a, b) => a.data.order - b.data.order)
    .map(async (feature) => {
      const { Content } = await feature.render();
      return { ...feature, Content };
    })
);
---

<section class="py-24 bg-primary dark:bg-page-dark text-white overflow-hidden transition-colors duration-500 relative">
  
  {/* 1. Det tekniske fundamentet (Rutenett + Lys) */}
  <div class="absolute inset-0 pointer-events-none">
    {/* Myk vignettering */}
    <div class="absolute -top-24 -left-24 w-96 h-96 bg-blue-400/20 dark:bg-primary/10 rounded-full blur-[120px]"></div>
    <div class="absolute -bottom-24 -right-24 w-96 h-96 bg-indigo-500/20 dark:bg-blue-600/10 rounded-full blur-[120px]"></div>

    {/* Rutenettet - nå med litt mer 'punch' enn forrige gang */}
    <div class="absolute inset-0 opacity-[0.08] dark:opacity-[0.12]" 
         style="background-image: linear-gradient(currentColor 1px, transparent 1px), linear-gradient(to right, currentColor 1px, transparent 1px); background-size: 50px 50px;">
    </div>
  </div>

  {/* 2. Geometriske figurer (Faste elementer som gir dybde) */}
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    {/* En stor, åpen sirkel oppe til høyre */}
    <div class="absolute top-10 right-[10%] w-64 h-64 border-2 border-white/5 dark:border-primary/10 rounded-full"></div>
    
    {/* Et "kode-residu" - et lite utsnitt av en ramme nede til venstre */}
    <div class="absolute bottom-20 left-[5%] w-40 h-40 border-l border-b border-white/10 dark:border-primary/20 opacity-50"></div>
    
    {/* En diagonal linje som bryter opp rutenettet */}
    <div class="absolute top-0 right-1/3 w-px h-64 bg-linear-to-b from-white/0 via-white/20 to-white/0 rotate-45"></div>
  </div>

  {/* 3. Subtilt tekst-residu (Ligger stødig i bakgrunnen) */}
  <div class="absolute bottom-10 right-10 pointer-events-none select-none opacity-[0.03] dark:opacity-[0.07]">
    <span class="font-mono text-8xl font-bold tracking-tighter">Comino Web</span>
  </div>

  <div class="container mx-auto px-6 relative z-10">
    <div class="grid lg:grid-cols-2 gap-20 items-center">
      {/* Innholdet ditt forblir det samme, men vil nå poppe mot denne dybden */}
      <div>
        <h2 class="text-4xl md:text-5xl font-bold mb-8 tracking-tight italic text-white">
          Hvorfor velge <span class="text-blue-200 dark:text-primary-light">Comino Web?</span>
        </h2>
        <p class="text-white/90 dark:text-slate-300 text-lg max-w-xl leading-relaxed">
          Vi bygger ikke nettsider på samlebånd. Vi bruker moderne verktøy og 
          stødig håndverk for å lage løsninger som er raske, trygge og enkle å eie.
        </p>
      </div>

      <div class="grid gap-12">
  {sortedFeatures.map(({ data, Content }) => (
    <div class="flex gap-6 group cursor-pointer border-b border-white/5 pb-8 last:border-0">
      {/* Ikon-boks */}
      <div class="w-14 h-14 shrink-0 bg-white/15 dark:bg-slate-800 rounded-2xl flex items-center justify-center border border-white/30 dark:border-slate-700 group-hover:bg-primary-light transition-all duration-500 shadow-xl">
         <svg class="w-7 h-7 text-white dark:text-primary-light group-hover:text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-width="2.5" d={data.iconName === 'lightning' ? "M13 10V3L4 14h7v7l9-11h-7z" : "M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"} />
         </svg>
      </div>

      <div class="flex-1">
        <h3 class="text-2xl font-bold mb-2 text-white group-hover:text-blue-200 transition-colors">
          {data.title}
        </h3>
        <p class="text-white/80 dark:text-slate-300 leading-relaxed text-lg">
          {data.description}
        </p>

        {/* DROPDOWN LOGIKK - Sjekk at disse klassene er med */}
        <div class="grid grid-rows-[0fr] opacity-0 group-hover:grid-rows-[1fr] group-hover:opacity-100 transition-all duration-500 ease-in-out">
          <div class="overflow-hidden">
            <div class="pt-4 text-white/60 dark:text-slate-400 prose prose-sm prose-invert border-l-2 border-white/20 pl-4 mt-2">
              <Content />
            </div>
          </div>
        </div>
      </div>
    </div>
  ))}
</div>
    </div>
  </div>
</section>