---
import Logo from "./Logo.astro";

const currentPath = Astro.url.pathname;

const navLinks = [
  { name: "Artikler", href: "/artikler" },
  { name: "Tjenester", href: "/tjenester" },
  { name: "Prosjekter", href: "/prosjekt" },
  { name: "Om oss", href: "/om-oss" },
];

const isActive = (path: string) =>
  path === "/" ? currentPath === "/" : currentPath.startsWith(path);
---

<header
  class="fixed top-0 w-full bg-white/80 dark:bg-page-dark/80 backdrop-blur-md z-50 border-b border-slate-100 dark:border-slate-800/60 transition-colors duration-500"
>
  <nav class="container mx-auto px-6 h-20 flex items-center justify-between">
    <Logo />

    <div class="flex items-center">
      {/* Mobil-knapp */}
      <button
        class="group md:hidden w-12 h-12 flex items-center justify-center relative z-120 cursor-pointer"
        aria-label="Meny"
        id="hamburger-btn"
      >
        <div class="relative w-7 h-5">
          <span id="line-1" class="absolute block w-7 h-0.5 bg-slate-900 dark:bg-white transition-all duration-300 top-0 rounded-full"></span>
          <span id="line-2" class="absolute block w-7 h-0.5 bg-slate-900 dark:bg-white transition-all duration-300 top-2 rounded-full"></span>
          <span id="line-3" class="absolute block w-7 h-0.5 bg-slate-900 dark:bg-white transition-all duration-300 top-4 rounded-full"></span>
        </div>
      </button>

      {/* Desktop Meny - Justert avstand for md-skjermer */}
      <ul class="hidden md:flex items-center md:gap-4 lg:gap-10">
        {
          navLinks.map((link) => {
            const active = isActive(link.href);
            return (
              <li class="relative">
                <a
                  href={link.href}
                  class:list={[
                    "transition-all font-bold text-sm uppercase py-2 whitespace-nowrap", // Lagt til whitespace-nowrap
                    "md:tracking-wider lg:tracking-widest", // Mindre tracking pÃ¥ nettbrett
                    active
                      ? "text-primary dark:text-primary-light"
                      : "text-slate-600 dark:text-slate-400 hover:text-primary dark:hover:text-white",
                  ]}
                >
                  {link.name}
                </a>

                {active && (
                  <div
                    transition:name="nav-indicator"
                    class="absolute -bottom-1 left-0 right-0 h-0.5 bg-primary dark:bg-primary-light rounded-full"
                  />
                )}
              </li>
            );
          })
        }
        <li class="md:pl-2 lg:pl-4">
          <a
            href="/kontakt"
            class="bg-primary text-white md:px-4 lg:px-6 py-2.5 rounded-xl font-bold hover:scale-105 active:scale-95 transition-all shadow-lg shadow-primary/20 text-sm uppercase md:tracking-normal lg:tracking-wider whitespace-nowrap"
          >
            Kontakt
          </a>
        </li>
      </ul>
    </div>
  </nav>

  {/* Mobilmeny Overlay (Uendret) */}
  <div
    id="mobilmeny-menu"
    class="hidden fixed inset-0 bg-white dark:bg-page-dark z-110 flex-col p-8 h-screen w-screen pt-32 transition-colors duration-500"
  >
    <nav class="flex flex-col space-y-4">
      {
        navLinks.map((link) => {
          const active = isActive(link.href);
          return (
            <a
              href={link.href}
              class:list={[
                "relative text-3xl font-bold py-4 transition-colors",
                active ? "text-primary dark:text-primary-light italic" : "text-slate-900 dark:text-slate-400",
              ]}
            >
              {link.name}
              {active && (
                <span class="text-primary dark:text-primary-light ml-2">.</span>
              )}
            </a>
          );
        })
      }
      <div class="pt-8">
        <a
          href="/kontakt"
          class="block bg-primary text-white text-center px-8 py-5 rounded-2xl font-bold text-xl shadow-xl shadow-primary/20"
        >
          Kontakt oss
        </a>
      </div>
    </nav>
  </div>
</header>

<script>
  /* Samme init-logikk som du hadde, den fungerer utmerket */
  const initNavbar = () => {
    const btn = document.getElementById("hamburger-btn");
    const menu = document.getElementById("mobilmeny-menu");
    const l1 = document.getElementById("line-1");
    const l2 = document.getElementById("line-2");
    const l3 = document.getElementById("line-3");

    if (!btn || !menu || !l1 || !l2 || !l3) return;

    const toggleMenu = () => {
      const isOpen = menu.classList.contains("flex");
      if (!isOpen) {
        menu.classList.replace("hidden", "flex");
        document.body.style.overflow = "hidden";
        l1.style.transform = "translateY(8px) rotate(45deg)";
        l2.style.opacity = "0";
        l3.style.transform = "translateY(-8px) rotate(-45deg)";
      } else {
        menu.classList.replace("flex", "hidden");
        document.body.style.overflow = "";
        l1.style.transform = "translateY(0) rotate(0)";
        l2.style.opacity = "1";
        l3.style.transform = "translateY(0) rotate(0)";
      }
    };

    btn.addEventListener("click", toggleMenu);
    menu.querySelectorAll("a").forEach(link => link.addEventListener("click", () => {
      if (menu.classList.contains("flex")) toggleMenu();
    }));
  };

  initNavbar();
  document.addEventListener("astro:after-swap", initNavbar);
</script>